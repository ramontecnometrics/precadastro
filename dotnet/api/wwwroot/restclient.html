<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <title>Rest Client</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 13px;
            color: lightgray;
            background-color: rgba(29, 38, 43, 0.87);
            margin: 0;
        }

        .center_body {
            margin-left: auto;
            margin-right: auto;
            text-align: center;
            width: 900px;
        }

        .content {
            text-align: left;
        }

        input,
        button {
            font-size: 11px;
            background-color: lightgray;
            font-family: verdana;
        }

        textarea {
            font-size: 10px;
            background-color: lightgray;
            white-space: break-spaces;
        }

        input[type='button'],
        button {
            width: 150px;
        }

        a {
            text-decoration: none;
            color: lightgray;
        }

        input,
        textarea {
            border: 0;
            padding: 3px;
        }

        textarea {
            font-size: 13px;
        }

        button {
            margin: 1px;
            border: 2px solid rgba(29, 38, 43, 0.87);
            height: 25px;
        }

        input,
        textarea,
        label {
            margin: 2px;
        }

        button:hover {
            border: 1px solid blue;
            margin: 2px 1px 2px 1px;
            height: 23px;
        }

        .content {
            border: 1px solid lightgrey;
        }

        .form-row {
            display: flex;
            vertical-align: text-top;
        }

        .field-label {
            min-width: 100px;
        }

        .field-value {
            width: 100%;
        }

            .field-value input,
            .field-value textarea {
                width: 100%;
            }

        .request-headers {
            height: 150px;
        }

        .request-content,
        .response-content {
            height: 300px;
        }

        #DateToConvert_Year {
            width: 30px;
        }

        #DateToConvert_Month,
        #DateToConvert_Day {
            width: 20px;
        }

        #imgProgress {
            height: 20px;
            display: none;
            margin: 2px;
        }

        fieldset div {
            border: 1px solid red;
        }
    </style>

    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ="
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.3.1/jquery.cookie.min.js"
            integrity="sha512-b/izKc7WrIrY5RZZsd0IHJLRWCmn8LVyqa7mofds7HKYd6vdB0pbvo5QHwsY/48N4LIhLZUiukEUas8byKDyqg=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/printThis/1.15.0/printThis.min.js"
            integrity="sha512-d5Jr3NflEZmFDdFHZtxeJtBzk0eB+kkRXWFQqEc1EKmolXjHm2IKCA7kTvXBNjIYzjXfD5XzIjaaErpkZHCkBg=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.4.0/clipboard.min.js"
            integrity="sha512-iJh0F10blr9SC3d0Ow1ZKHi9kt12NYa+ISlmCdlCdNZzFwjH1JppRTeAnypvUez01HroZhAmP4ro4AvZ/rG0UQ=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"></script>

    <script type="text/javascript">
        'use strict';

        function JsonRequest(url, methodType, headers, successFn, errorFn) {
            var numeroDeRepeticoes = $('#edtNumeroDeRepeticoes').val();
            if (!numeroDeRepeticoes || isNaN(numeroDeRepeticoes)) {
                numeroDeRepeticoes = 1;
            }

            var intervaloEntreRepeticoes = $('#edtIntervaloEntreRepeticoes').val();
            if (!intervaloEntreRepeticoes || isNaN(intervaloEntreRepeticoes)) {
                intervaloEntreRepeticoes = 0;
            }

            let contador = 0;

            let intervalId = setInterval(() => {
                contador++;

                var inputData = $('#jsonContent').val();

                $.ajax({
                    async: true,
                    dataType: 'text',
                    type: methodType,
                    url: url,
                    headers: headers,
                    data: inputData,
                    success: function (d, e, f) {
                        $('#imgProgress').css('display', 'none');
                        if (d) {
                            $('#response').val($('#response').val() + '\n' + d);
                        }
                    },
                    error: function (xhr) {
                        $('#imgProgress').css('display', 'none');
                        $('#response').val(xhr.responseText);
                        $('#response').val($('#response').val() + '\n' + xhr.responseText);
                    },
                }).fail(function (xhr) {
                    $('#imgProgress').css('display', 'none');
                    $('#response').val($('#response').val() + '\n' + JSON.stringify(xhr));
                });

                if (contador >= numeroDeRepeticoes) {
                    clearInterval(intervalId);
                }
            }, intervaloEntreRepeticoes);
        }

        function Do(methodType) {
            try {
                $('#imgProgress').css('display', 'block');
                $('#response').val('');

                var jsonHeaders = $('#headers').val();
                var headers = null;
                if (!!jsonHeaders) {
                    try {
                        headers = JSON.parse(jsonHeaders);
                    } catch (e) {
                        alert('The headers string is not valid Json object.');
                        $('#imgProgress').css('display', 'none');
                        return;
                    }
                }
                return JsonRequest($('#url').val(), methodType, headers);
            } catch (err) {
                $('#imgProgress').css('display', 'none');
                $('#response').val(err.message + '\n' + err.stack);
            }
        }

        function DoGet() {
            return Do('GET');
        }

        function DoPost() {
            return Do('POST');
        }

        function DoDelete() {
            return Do('DELETE');
        }

        function ConvertDate() {
            var year = Number($('#DateToConvert_Year').val());
            var month = Number($('#DateToConvert_Month').val()) - 1;
            var day = Number($('#DateToConvert_Day').val());
            var date = new Date(year, month, day);
            $('#ConvertedDate').val(date.getTime());
            $('#ConvertedDate2').val('\\/Date(' + $('#ConvertedDate').val() + ')\\/');
        }

        function ConvertJSDate() {
            var date = new Date(Number($('#JSDateToConvert').val()));
            $('#ConvertedJSDate').val(date.toLocaleDateString());
        }

        function SaveRequest() {
            $.cookie('rest_client_url', $('#url').val(), {
                expires: 100,
            });
            $.cookie('rest_client_username', $('#username').val(), {
                expires: 100,
            });
            $.cookie('rest_client_password', $('#password').val(), {
                expires: 100,
            });
            $.cookie('rest_client_request', $('#jsonContent').val(), {
                expires: 100,
            });
            $.cookie('rest_client_request_headers', $('#headers').val(), {
                expires: 100,
            });
            alert('Requisição salva com sucesso!');
        }

        function ReiniciarForm() {
            var headers = {
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                accept: 'application/json',
            };
            $('#headers').val(
                '{\n"contentType": "application/json; charset=utf-8",\n"dataType": "json",\n"accept": "application/json"\n}'
            );
        }

        $(document).ready(function () {
            $('#btnGet').click(DoGet);
            $('#btnPost').click(DoPost);
            $('#btnDelete').click(DoDelete);
            $('#btnConvertDate').click(ConvertDate);
            $('#btnSaveRequest').click(SaveRequest);
            $('#url').val($.cookie('rest_client_url'));
            $('#username').val($.cookie('rest_client_username'));
            $('#password').val($.cookie('rest_client_password'));
            $('#jsonContent').val($.cookie('rest_client_request'));
            $('#headers').val($.cookie('rest_client_request_headers'));
            $('#btnConvertJSDate').click(ConvertJSDate);
        });
    </script>
</head>

<body>
    <div class="center_body">
        <div class="content">
            <div class="form-row">
                <div class="field-label">
                    <label>URL</label>
                </div>
                <div class="field-value">
                    <input type="text" id="url" value="" />
                </div>
            </div>

            <div class="form-row">
                <div class="field-label">
                    <label>Cabeçalhos</label>
                </div>
                <div class="field-value">
                    <textarea class="request-headers" id="headers"></textarea>
                </div>
            </div>

            <div class="form-row">
                <div class="field-label">
                    <label>Requisição</label>
                </div>
                <div class="field-value">
                    <textarea class="request-content" id="jsonContent"></textarea>
                </div>
            </div>

            <div class="form-row">
                <div class="field-label">
                    <label>Executar</label>
                </div>
                <div>
                    <div style="display: flex">
                        <button id="btnGet">GET</button>
                        <button id="btnPost">POST</button>
                        <button id="btnDelete">DELETE</button>
                        <img id="imgProgress" src="./loading.gif" />
                        <span style="margin-top: 3px">Repetir N vezes:</span>
                        <input type="text" style="width: 60px" id="edtNumeroDeRepeticoes" />
                        <span style="margin-top: 3px">Intervalo (ms):</span>
                        <input type="text" style="width: 60px" id="edtIntervaloEntreRepeticoes" />
                    </div>
                </div>
            </div>

            <div class="form-row">
                <div class="field-label">
                    <label>Resposta</label>
                </div>
                <div class="field-value">
                    <textarea class="response-content" id="response" readonly="readonly"></textarea>
                </div>
            </div>
            <hr />
            <div class="form-row">
                <div class="field-label"></div>
                <div class="field-value">
                    <button id="btnSaveRequest">Salvar requisição</button>
                </div>
            </div>
            <hr />
            <div class="form-row">
                <div class="field-label">
                    <label>Utilitários</label>
                </div>
                <div>
                    <div class="form-row">
                        <label>Data (PT-BR)</label>
                        <input type="text" id="DateToConvert_Day" value="01" />
                        <input type="text" id="DateToConvert_Month" value="07" />
                        <input type="text" id="DateToConvert_Year" value="2017" />
                        <button id="btnConvertDate">Converter</button>
                        <input type="text" id="ConvertedDate" value="" readonly="readonly" />
                        <input type="text" id="ConvertedDate2" value="" readonly="readonly" />
                    </div>
                    <div class="form-row">
                        <label>Data Javascript</label>
                        <input type="text" id="JSDateToConvert" value="" />
                        <button id="btnConvertJSDate">Converter</button>
                        <input type="text" id="ConvertedJSDate" value="" readonly="readonly" />
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
